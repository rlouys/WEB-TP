{% extends "main.html" %}
{% block body %}
<br>

    <div style="max-width: 90%!important;" class="listePage">
        <h1>Bienvenue dans la bibliothèque!</h1>
        <br><br>
        <h4>Ici vous pouvez voir et gérer votre collection de livres.</h4>
        <br>

        <div class="header-container">
            <h3>Liste des livres</h3>
            <h6 id="nombre-livre" class="book-count-container">
                Nombre de livres :
                <p class="book-count" >{{length}}</p>
            </h6>
        </div>
        <br>
            <div id="livres-list">
                <div>
                    <!-- TABLEAU -->
                    <table class="table table-responsive-sm table-light table-hover" >
                        <thead>
                            <tr class="table-success">
                                <th scope="col" style="text-align: right; "><i class="fa-solid fa-book"></i> TITRE </th>
                                <th scope="col"><i class="fa-solid fa-user"></i> Auteur</th>
                                <th scope="col"><i class="fa-solid fa-building"></i> Editeur</th>
                                <th scope="col"><i class="fa-solid fa-tags"></i> Prix </th>
                                <th scope="col"><i class="fa-solid fa-tags"></i> Stock </th>
                                <th scope="col"><i class="fa-solid fa-key"></i> Owner </th>
                                <th scope="col"><i class="fa-solid fa-key"></i> Nom complet </th>

                                <!-- on gérera ici le fait d'afficher le propriétaire ou pas -->
                                {% if 1 %}
                                {% endif %}

                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for livre in livres %}
                                {% if livre.stock > 0 or user_isadmin%}
                                <tr>
                                    <td style="text-align: right; border-right: 1px solid grey;">{{livre.nom}}</td>
                                    <td>{{livre.auteur}}</td>
                                    <td>{{livre.editeur}}</td>
                                    <td>{{livre.price}} €</td>
                                    <td>{{livre.stock}}</td>
                                    <td>{{livre.owner.username}}</td>
                                    <td>{{livre.owner.name|upper}} {{livre.owner.firstname}}</td>
                                    <td>
                                        <!-- BUTTON EDIT -->
                                        <div class="flex items-center">
                                            {% if username|lower == livre.owner.username|lower or user_isadmin%}
                                            <button type="button" class="btn btn-light w-10 h-10 p-0 rounded-full" onclick="redirectToModify({{ livre.id }})">
                                                <i class="fa-regular fa-pen-to-square fa-xl"></i>
                                            </button>
                                            {% endif %}
                                            <!-- BUTTON DELETE -->
                                            {% if username|lower == livre.owner.username|lower or user_isadmin%}
                                            <button type="submit" class="btn btn-light w-10 h-10 p-0 rounded-full" onclick="confirmDeletion({{livre.id}})">
                                                <i class="fa-solid fa-trash fa-xl"></i>
                                            </button>
                                            {% endif %}
                                        </div>

                                    </td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                <br>

                <!-- PAGE NAVIGATION -->
                 <div class="pagination-container">
                            <nav aria-label="Page navigation">
                                <ul class="pagination nav-clue">
                                    {% if page > 3 %}
                                        <li style="z-index: 2;" class="page-item"><a class="page-link" href="/liste?page=1"><i class="fa-solid fa-backward-fast"></i></a></li>
                                    {% endif %}

                                    {% if page > 1 %}
                                        <li style="z-index: 2;" class="page-item"><a class="page-link" href="/liste?page={{ page - 1 }}">Previous</a></li>
                                    {% endif %}
                                    <!-- LOGIQUE D'AFFICHAGE DES BOUTONS -->
                                    {% set max_displayed_pages = 5 %}
                                    {% set start_page = 1 %}
                                    {% set end_page = total_pages %}
                                    {% if total_pages > max_displayed_pages %}
                                        {% set start_page = (page - (max_displayed_pages // 2)) %}
                                        {% set end_page = (page + (max_displayed_pages // 2)) %}
                                        {% if start_page < 1 %}
                                            {% set start_page = 1 %}
                                            {% set end_page = max_displayed_pages %}
                                        {% elif end_page > total_pages %}
                                            {% set end_page = total_pages %}
                                            {% set start_page = total_pages - max_displayed_pages + 1 %}
                                        {% endif %}
                                    {% endif %}

                                    {% for num in range(start_page, end_page + 1) %}
                                        <li class="page-item {% if num == page %}active{% endif %}">
                                            <a style="z-index: 2;" class="page-link" href="/liste?page={{ num }}">{{ num }}</a>
                                        </li>
                                    {% endfor %}

                                    {% if end_page < total_pages %}
                                        <li class="page-item disabled"><a class="page-link">...</a></li>
                                        <li class="page-item">
                                            <a style="z-index: 2;" class="page-link" href="/liste?page={{ total_pages }}">{{ total_pages }}</a>
                                        </li>
                                    {% endif %}

                                    {% if page < total_pages %}
                                        <li style="z-index: 2;" class="page-item"><a class="page-link" href="/liste?page={{ page + 1 }}">Next</a></li>
                                    {% endif %}
                                </ul>
                            </nav>



                            <div>
                                <!-- BOUTONS SPÉCIAUX -->
                                {% if privileges == "admin" %}

                                <!-- VIDE LES LIVRES -->
                                <a href='/empty_livres' id="empty table" class="btn btn-outline-success">Empty Table</a>

                                <div class="btn-group">
                                    <!-- ADD RANDOM BOOKS -->
                                    <a href="javascript:void(0)" class="btn btn-success active disabled"  data-mdb-ripple-init>Add Random Books</a>
                                    <!-- AJOUTER 10 LIVRES -->
                                    <a href="javascript:void(0)" id="add-random-books-10" class="btn btn-outline-success btn-adduser"  data-mdb-ripple-init>10</a>
                                    <!-- AJOUTER 100 LIVRES -->
                                    <a href="javascript:void(0)" id="add-random-books-100" class="btn btn-outline-success btn-adduser"  data-mdb-ripple-init>100</a>
                                </div>
                                {% endif %}
                                {% if is_authenticated %}
                                <a href='/ajouter' class="btn btn-outline-success">Ajouter un nouveau livre</a>
                                {% endif %}
                            </div>
                        </div>

        </div>
    </div>
</div>
 <br><br><br><br>



{% endblock %}



